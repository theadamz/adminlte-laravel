import{f as o}from"./application-BtXPZOJh.js";import{h as i,d as m,p as r,e as d,M as l,s as c,l as f,q as h,f as p,r as _,g as v}from"./general-DAK3ebw_.js";const w=document.querySelector("#formInput");function b(){_formValidation=$(w).validate({rules:{user_name:{required:!0},subject:{required:!0},request_category:{required:!0},asset_category:{required:$("#include_asset").val()=="true"},asset:{required:$("#include_asset").val()=="true"},entity:{required:!0},site:{required:!0},building:{required:!0}},submitHandler:function(n,s){s.preventDefault(),$(n).valid()&&R()}})}function y(){i(".ticket-main-container"),m("#detail_description","detail_description",200),document.querySelector("#reset").addEventListener("click",function(){window.location.reload()}),$("#ticket_behalf").on("select2:select",function(n){const s=n.params.data;$("#department").val(s.department.name),k()}),$(".detail-description-button-insert-content").on("click",function(){const n=$(this).data("value");tinymce.activeEditor.execCommand("mceInsertContent",!1,`<strong>${n}</strong>`)}),$("#request_category").on("select2:select",function(n){const s=n.params.data;$(".category-description").html(s.description)}),$("#include_asset").on("change",function(){const n=$(this).val()!="true";_formValidation.resetForm(),$("#asset_category").prop("disabled",n),$("#asset").prop("disabled",n)}),$("#asset_category").on("change",function(){$(this).val()&&($("#asset").val(null).empty().trigger("change"),$("#site").val(null),$("#building").val(null))}),$("#asset").on("select2:select",function(n){const s=n.params.data;$("#asset_info_site").val(s.site_name),$("#asset_info_building").val(s.building_name)}),$("#entity").on("change",function(){$(this).val()&&(o("#site",`${_baseURL}/s2/configs/setups/sites/${$(this).val()}`,user.site_id),$("#site").val(null).empty().trigger("change"),$("#building").val(null).empty().trigger("change"))}),$("#site").on("change",function(){$(this).val()&&(o("#building",`${_baseURL}/s2/configs/setups/buildings/${$(this).val()}`),setTimeout(()=>{$("#building").prop("selectedIndex",1).trigger("change")},500))}),o("#site",`${_baseURL}/s2/configs/setups/sites/${user.entity_id}`,user.site_id),i(".ticket-main-container",!1)}function x(){const n=function(e){return e.id?e.id==user.id?"No results found":`<div class="d-flex flex-column">
                    <span class="font-weight-bold">${e.name}</span>
                    <span class="font-weight-light">${e.department.name}</span>
                    <span class="font-weight-light${e.email==e.username?" d-none":""}">${e.username}</span>
                    <span class="font-weight-light">${e.email}</span>
                </div>`:e.text},s=function(e){return e.id?`<div class="d-flex">
                    <span class="font-weight-bold mr-1">${e.name}</span>
                    <span class="font-weight-light">(${e.email})</span>
                </div>`:e.text};r("#ticket_behalf","Select",`${_baseURL}/s2/configs/users`,2,n,s);const a=function(e){return e.id?`<div class="d-flex flex-column">
                    <span class="font-weight-bold">${e.name}</span>
                    <span class="font-weight-light">${e.description}</span>
                </div>`:e.text},t=function(e){return e.id&&e.text||!e.id?e.text:`${e.name}`};if(r("#request_category","Select",`${_baseURL}/s2/configs/helpdesks/categories?ticket_purpose=${purposeId}`,0,a,t),defaultRequestCategory){const e=new Option(t(defaultRequestCategory),defaultRequestCategory.id,!0,!0);$("#request_category").append(e).trigger("change"),$(".category-description").html(defaultRequestCategory.description)}const u=function(e){return e.id?e.id==user.id?"No results found":`<div class="d-flex flex-column">
                    <span class="font-weight-bold">${e.name}</span>
                    <span class="font-weight-light">${e.department.name}</span>
                    <span class="font-weight-light${e.email==e.username?" d-none":""}">${e.username}</span>
                    <span class="font-weight-light">${e.email}</span>
                </div>`:e.text},g=function(e){return e.id?`${e.username}`:e.text};r("#inform_users","Select",`${_baseURL}/s2/configs/users`,2,u,g,!1,!0)}function S(){const n=function(t){return t.id?`<div class="d-flex flex-column">
                    <span class="font-weight-bold">${t.asset_alias_id}</span>
                    <span class="font-weight-light">${t.asset_name}</span>
                    <span class="font-weight-light">${t.type}</span>
                    <span class="font-weight-light">${t.site_name} - ${t.building_name}</span>
                </div>`:t.text},s=function(t){return t.id&&t.text||!t.id?t.text:`<div class="d-flex">
                    <span class="font-weight-bold mr-1">${t.asset_alias_id}</span>
                    <span class="font-weight-light">(${t.asset_name})</span>
                </div>`};$("#asset").select2({dropdownParent:null,theme:"bootstrap4",placeholder:"Select",minimumInputLength:2,multiple:!1,allowClear:!1,closeOnSelect:!0,ajax:{url:`${_baseURL}/s2/inventories/assets`,type:"GET",dataType:"json",delay:400,data:function(t){return{keyword:t.term,asset_category:$("#asset_category").val()}},processResults:function(t,u){return{results:t.data}},cache:!0},escapeMarkup:function(t){return t},templateSelection:s,templateResult:n});const a=new Option(s(userAsset),userAsset.id,!0,!0);$("#asset").append(a).trigger("change")}function q(){d("#phone_ext"),d("#subject")}async function R(){if(!await l.Confirm("Are you sure want to save?").catch(t=>{t&&console.log(t)}))return;c(!0,"#save"),f(!0,"Please wait","Saving..."),_data2Send=h($("#formInput").serialize(),!1),_data2Send.inform_users=$("#inform_users").val();const s=await p($("#formInput").attr("action"),"POST",_data2Send,"application/json");if(![201].includes(s.status)){l.HtmlNotification(_(s.data),`${s.status} - ${s.statusText}`),v(s.data.errors),c(!1,"#save");return}c(!1,"#save"),f(!1),await l.ConfirmHtml(`${s.data.message}<br/><br/>Create new ticket?`).catch(t=>{t&&console.log(t)})?$("#reset").click():window.location.href=cancelURL}async function k(){i(".ticket-asset-information");const n=await p(`${_baseURL}/assets/${$("#ticket_behalf").val()}`,"GET");if(![200].includes(n.status))return;const s=n.data.data;if(s){const a=new Option(`<div class="d-flex">
                <span class="font-weight-bold mr-1">${s.asset_alias_id}</span>
                <span class="font-weight-light">(${s.asset_name})</span>
            </div>`,s.id,!0,!0);$('#asset_category option[value="'+s.asset_category_id+'"]').prop("selected",!0).change(),$("#asset").append(a).trigger("change"),$("#asset_info_site").val(s.site_name),$("#asset_info_building").val(s.building_name)}else $('#asset_category option[value=""]').prop("selected",!0).change(),$("#asset").val(null).empty().trigger("change"),$("#asset_info_site").val(null),$("#asset_info_building").val(null);i(".ticket-asset-information",!1)}document.addEventListener("DOMContentLoaded",function(){b(),q(),x(),S(),y()});

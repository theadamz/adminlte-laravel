import{f as b}from"./application-BtXPZOJh.js";import{i as p,a as L,v as F,c as m,x as v,e as y,M as l,s as r,f as c,r as u,g as h,h as s,_ as x,l as o,w as V}from"./general-DAK3ebw_.js";let f=null;const O=document.querySelector("#formInput");let n={},_=null;const T=document.querySelector("#formImport");function S(){_dataTable=$("#list_datatable").DataTable({lengthMenu:[[10,25,50,100,-1],[10,25,50,100,"All"]],pageLength:50,numbers_length:4,searchDelay:500,processing:!0,serverSide:!0,scrollX:!0,scrollY:!0,stateSave:_dataTableUseState,stateDuration:_dataTableStateDuration,scrollY:_dataTableScrollY,order:[[1,"asc"]],select:{items:"row",style:"single",className:"bg-warning"},headerCallback:function(t,e,a,i,A){t.getElementsByTagName("th")[0].innerHTML=`
          <div class="form-check">
             <input class="form-check-input datatable-group-checkable" type="checkbox" value="" id="groupCheckable" />
        <label class="form-check-label"></label>
          </div>`},createdRow:function(t,e,a){_dataTableSelectedValues.indexOf(e[_dataTableSelectColumn])>-1&&$(t).addClass("bg-light")},ajax:{url:`${_baseURL}/dt/configs/inventories/devices`,type:"GET",data:function(t){t.category=$("#filter_category").val(),t.category_sub=$("#filter_category_sub").val(),t.brand=$("#filter_brand").val(),t.model=$("#filter_model").val(),t.status=$("#filter_status").val()}},columns:[{data:"id",width:"30px",orderable:!1,searchable:!1,render:function(t,e,a,i){return`<div class="form-check">
                             <input class="form-check-input datatable-checkable" type="checkbox" value="${t}" ${_dataTableSelectedValues.indexOf(t)>-1?"checked":""} data-index="${i.row}" />
                                      <label class="form-check-label"></label>
                          </div>`}},{data:"asset_category_name",render:function(t,e,a,i){return`${a.asset_category_code} - ${t}`}},{data:"asset_category_name",render:function(t,e,a,i){return`${a.asset_category_sub_code} - ${t}`}},{data:"asset_brand_name",render:function(t,e,a,i){return`${a.asset_brand_code} - ${t}`}},{data:"asset_model_name",render:function(t,e,a,i){return`${a.asset_model_code} - ${t}`}},{data:"code"},{data:"deprication_period",width:"50px",className:"text-center"},{data:"description"}]}).on("xhr.dt",function(t,e,a,i){setTimeout(()=>{_dataTable.columns.adjust()},300)}).on("draw.dt",function(t,e,a,i){p(_dataTable)}),L(_dataTable,'input[type="search"]'),document.querySelector("#refresh").addEventListener("click",()=>d(!1)),document.querySelector("#filterReset").addEventListener("click",q),document.querySelector("#formFilter").addEventListener("submit",t=>{t.preventDefault(),d(),$("#modalFormFilter").modal("hide")})}function E(){_formValidation=$(O).validate({rules:{code:{required:!0,regex:F},category:{required:!0},category_sub:{required:!0},brand:{required:!0},model:{required:!0},deprication_period:{required:!0},description:{required:!0}},submitHandler:C}),_=$(T).validate({rules:{file:{required:!0,accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",extension:"xlsx",filesize:2048}},submitHandler:N})}function w(){$("#modalFormInput").on("hidden.bs.modal",g),m("#modalFormInput"),document.getElementById("categoryLOV").addEventListener("click",M),document.getElementById("subCategoryLOV").addEventListener("click",P),document.getElementById("brandLOV").addEventListener("click",H),document.getElementById("modelLOV").addEventListener("click",j),m("#modalFormImport"),m("#modalFormFilter"),v("#filter_category","Select",`${_baseURL}/s2/configs/inventories/categories`,["id","name"],0),v("#filter_brand","Select",`${_baseURL}/s2/configs/inventories/brands`,["id","name"],0),$("#filter_category").on("change",function(){$(this).val()&&($("#filter_category_sub").val(null).empty().trigger("change"),b("#filter_category_sub",`${_baseURL}/s2/configs/inventories/sub-categories/${$(this).val()}`))}),$("#filter_brand").on("change",function(){$(this).val()&&($("#filter_model").val(null).empty().trigger("change"),b("#filter_model",`${_baseURL}/s2/configs/inventories/models/${$(this).val()}`))}),document.getElementById("export").addEventListener("click",U)}function k(){document.querySelector("#edit").addEventListener("click",()=>{const t=_dataTable.row({selected:!0}).data();typeof t>"u"||D(t.id.trim())}),document.querySelector("#delete").addEventListener("click",R)}function I(){y("#code"),y("#description")}function C(){l.Confirm("Are you sure?").then(t=>{r(!0,"#save"),f=`${_baseURL}/configs/inventories/devices`,_action==="edit"&&(f+=`/${_id}`);const e=_action==="create"?"POST":"PUT";_data2Send=$("#formInput").serialize(),c(f,e,_data2Send).then(a=>{[201,200].includes(a.status)?(_action="create",Toast.fire({icon:"success",title:a.statusText,text:a.data.message}),g(),d(!1),$("#modalFormInput").modal("hide")):(l.HtmlNotification(u(a.data),`${a.status} - ${a.statusText}`),h(a.data.errors)),r(!1,"#save")}).catch(a=>{l.Notification(a.toString()),r(!1,"#save")})}).catch(t=>{t&&console.log(t)})}function D(t=null){_id=t,s("#list_datatable"),c(`${_baseURL}/configs/inventories/devices/${_id}`,"GET").then(e=>{if([200].includes(e.status)){g(),_action="edit";const a=e.data.data;$("#code").val(a.code),$("#deprication_period").val(a.deprication_period),$("#description").val(a.description),$("#category").val(a.asset_category_id),$("#category_name").val(`${a.asset_category_code} - ${a.asset_category_name}`),$("#category_sub").val(a.asset_category_sub_id),$("#category_sub_name").val(`${a.asset_category_sub_code} - ${a.asset_category_sub_name}`),$("#brand").val(a.asset_brand_id),$("#brand_name").val(`${a.asset_brand_code} - ${a.asset_brand_name}`),$("#model").val(a.asset_model_id),$("#model_name").val(`${a.asset_model_code} - ${a.asset_model_name}`),$("#modalFormInput").modal("show")}else l.HtmlNotification(u(e.data),`${e.status} - ${e.statusText}`);s("#list_datatable",!1)}).catch(e=>{l.Notification(e.toString()),s("#list_datatable",!1)})}function R(){if(_dataTableSelectedValues.length<=0){l.HtmlNotification("Select 1 atau more data.");return}l.Confirm(`Are you sure want to delete ${_dataTableSelectedValues.length} data?`,null,"warning").then(t=>{r(!0,"#delete"),s("#list_datatable"),_data2Send=new URLSearchParams({id:JSON.stringify(_dataTableSelectedValues)}),c(`${_baseURL}/configs/inventories/devices`,"DELETE",_data2Send).then(e=>{[200].includes(e.status)?(Toast.fire({icon:"success",title:e.statusText,text:e.data.message}),x(),d(!1)):l.HtmlNotification(u(e.data),`${e.status} - ${e.statusText}`),r(!1,"#delete"),s("#list_datatable",!1)}).catch(e=>{l.Notification(e.toString()),r(!1,"#delete"),s("#list_datatable",!1)})}).catch(t=>{t&&console.log(t)})}async function U(){if(!await l.Confirm("Are you sure?").catch(a=>{a&&console.log(a)}))return;o(!0,"Please wait","Processing data...");const e=await c(`${_baseURL}/configs/inventories/devices/exports`,"POST",{category:$("#filter_category").val(),category_sub:$("#filter_category_sub").val(),brand:$("#filter_brand").val(),model:$("#filter_model").val(),status:$("#filter_status").val()},"application/json");if(![200].includes(e.status)){l.HtmlNotification(u(e.data),`${e.status} - ${e.statusText}`);return}V(e.data.url),o(!1)}function d(t=!0){_dataTable.ajax.reload(null,t)}function g(){_action="create",_formValidation.resetForm(),$("#formInput")[0].reset(),$("#category, #brand").val(null).trigger("change"),n={}}function q(){$("#filter_category").val(null).empty().trigger("change"),$("#filter_category_sub").val(null).empty().trigger("change"),$("#filter_brand").val(null).empty().trigger("change"),$("#filter_model").val(null).empty().trigger("change"),$("#formFilter")[0].reset()}async function N(){if(!await l.Confirm("Are you sure?").catch(a=>{a&&console.log(a)}))return;$("#upload_info").val(null),r(!0,"#upload"),o(!0),_data2Send=new FormData($("#formImport")[0]);const e=await c(`${_baseURL}/configs/inventories/devices/imports`,"POST",_data2Send,null);if(![201].includes(e.status)){r(!1,"#upload"),o(!1),l.HtmlNotification(u(e.data),`${e.status} - ${e.statusText}`),h(e.data.errors,_),$("#upload_info").val(e.data.info);return}r(!1,"#upload"),o(!1),Toast.fire({icon:"success",title:e.statusText,text:e.data.message}),$("#upload_info").val(e.data.info),B(),d(!1),$("#modalFormInput").modal("hide")}function B(){_data2Send=null,_.resetForm(),$("#file").next().html("Choose file"),$("#file").val("")}function M(){o(),$("#_dynamic_content").load(`${_baseURL}/lov/configs/inventories/categories?is_active=true`,()=>{o(!1),$("#_modal_lov").modal("show"),$(".modal-dialog").addClass("modal-lg"),$("#_modal_lov").on("hide.bs.modal",function(){if($resultFromLOV.result){if(n.category==$resultFromLOV.data.id)return;n.category=$resultFromLOV.data.id,$("#category").val($resultFromLOV.data.id),$("#category_name").val(`${$resultFromLOV.data.code} - ${$resultFromLOV.data.name}`),$("#category_sub").val(null),$("#category_sub_name").val(null)}})})}function P(){$("#category").val()&&(o(),$("#_dynamic_content").load(`${_baseURL}/lov/configs/inventories/sub-categories?category=${$("#category").val()}`,()=>{o(!1),$("#_modal_lov").modal("show"),$(".modal-dialog").addClass("modal-lg"),$("#_modal_lov").on("hide.bs.modal",function(){if($resultFromLOV.result){if(n.category_sub==$resultFromLOV.data.id)return;n.category_sub=$resultFromLOV.data.id,$("#category_sub").val($resultFromLOV.data.id),$("#category_sub_name").val(`${$resultFromLOV.data.code} - ${$resultFromLOV.data.name}`)}})}))}function H(){o(),$("#_dynamic_content").load(`${_baseURL}/lov/configs/inventories/brands`,()=>{o(!1),$("#_modal_lov").modal("show"),$(".modal-dialog").addClass("modal-lg"),$("#_modal_lov").on("hide.bs.modal",function(){if($resultFromLOV.result){if(n.brand==$resultFromLOV.data.id)return;n.brand=$resultFromLOV.data.id,$("#brand").val($resultFromLOV.data.id),$("#brand_name").val(`${$resultFromLOV.data.code} - ${$resultFromLOV.data.name}`),$("#model").val(null),$("#model_name").val(null)}})})}function j(){$("#brand").val()&&(o(),$("#_dynamic_content").load(`${_baseURL}/lov/configs/inventories/models?brand=${$("#brand").val()}`,()=>{o(!1),$("#_modal_lov").modal("show"),$(".modal-dialog").addClass("modal-lg"),$("#_modal_lov").on("hide.bs.modal",function(){if($resultFromLOV.result){if(n.model==$resultFromLOV.data.id)return;n.model=$resultFromLOV.data.id,$("#model").val($resultFromLOV.data.id),$("#model_name").val(`${$resultFromLOV.data.code} - ${$resultFromLOV.data.name}`)}})}))}document.addEventListener("DOMContentLoaded",function(){S(),E(),w(),I(),k()});

import{b as _,i as b,a as h,c as g,d as p,e as d,M as s,s as i,f as u,r as m,g as k,h as n,j as v,_ as T,l as o}from"./general-DAK3ebw_.js";let r=null;const y=document.querySelector("#formInput");function S(){_dataTable=$("#list_datatable").DataTable({lengthMenu:[[10,25,50,100,100,-1],[10,25,50,100,100,"All"]],pageLength:50,numbers_length:4,searchDelay:500,processing:!0,serverSide:!0,scrollX:!0,stateSave:_dataTableUseState,stateDuration:_dataTableStateDuration,scrollY:_dataTableScrollY,order:[[0,"asc"]],select:{items:"row",style:"single",className:"bg-warning"},headerCallback:function(e,t,a,l,M){e.getElementsByTagName("th")[0].innerHTML=`
            <div class="form-check">
               <input class="form-check-input datatable-group-checkable" type="checkbox" value="" id="groupCheckable" />
					<label class="form-check-label"></label>
            </div>`},createdRow:function(e,t,a){_dataTableSelectedValues.indexOf(t[_dataTableSelectColumn])>-1&&$(e).addClass("bg-light")},ajax:{url:`${_baseURL}/dt/configs/helpdesks/ticket-templates`,type:"GET",data:function(e){e.is_visible=$("#filter_is_visible").val()}},columns:[{data:"id",width:"30px",orderable:!1,searchable:!1,render:function(e,t,a,l){return`<div class="form-check">
                               <input class="form-check-input datatable-checkable" type="checkbox" value="${e}" ${_dataTableSelectedValues.indexOf(e)>-1?"checked":""} data-index="${l.row}" />
                                        <label class="form-check-label"></label>
                            </div>`}},{data:"ticket_purpose_name",name:"b.name"},{data:"ticket_category_name",name:"c.name"},{data:"name"},{data:"subject"},{data:"is_visible",className:"dt-center",searchable:!1,render:function(e,t,a,l){return _(e)?'<span class="badge font-weight-normal badge-success">Yes</span>':'<span class="badge font-weight-normal badge-warning">No</span>'}}]}).on("xhr.dt",function(e,t,a,l){setTimeout(()=>{_dataTable.columns.adjust()},300)}).on("draw.dt",function(e,t,a,l){b(_dataTable)}),h(_dataTable,'input[type="search"]'),document.querySelector("#refresh").addEventListener("click",()=>c(!1)),document.querySelector("#filterReset").addEventListener("click",I),document.querySelector("#formFilter").addEventListener("submit",e=>{e.preventDefault(),c(),$("#modalFormFilter").modal("hide")})}function L(){_formValidation=$(y).validate({rules:{ticket_purpose:{required:!0},name:{required:!0},subject:{required:!0},ticket_category:{required:!0}},submitHandler:w})}function x(){$("#modalFormInput").on("hidden.bs.modal",f),g("#modalFormInput"),p("#notes","notes",200),document.getElementById("ticketPurposeLOV").addEventListener("click",O),document.getElementById("ticketCategoryLOV").addEventListener("click",D)}function E(){_permissions.edit&&document.querySelector("#edit").addEventListener("click",()=>{typeof _dataTable.row({selected:!0}).data()>"u"||F(_dataTable.row({selected:!0}).data().id.trim())}),_permissions.delete&&document.querySelector("#delete").addEventListener("click",C)}function V(){d("#name"),d("#subject"),d("#notes")}function w(){s.Confirm("Are you sure?").then(e=>{i(!0,"#save"),r=`${_baseURL}/configs/helpdesks/ticket-templates`,_action==="edit"&&(r+=`/${_id}`);const t=_action==="create"?"POST":"PUT",a=$("#is_visible").is(":checked")?"":"&is_visible=false";_data2Send=$("#formInput").serialize()+a,u(r,t,_data2Send).then(l=>{[201,200].includes(l.status)?(_action="create",Toast.fire({icon:"success",title:l.statusText,text:l.data.message}),f(),c(!1),$("#modalFormInput").modal("hide")):(s.HtmlNotification(m(l.data),`${l.status} - ${l.statusText}`),k(l.data.errors)),i(!1,"#save")}).catch(l=>{s.Notification(l.toString()),i(!1,"#save")})}).catch(e=>{e&&console.log(e)})}function F(e=null){_id=e,n("#list_datatable"),u(`${_baseURL}/configs/helpdesks/ticket-templates/${_id}`,"GET",null).then(t=>{if([200].includes(t.status)){f(),_action="edit";const a=t.data.data;$("#ticket_purpose").val(a.ticket_purpose),$("#ticket_purpose_name").val(a.ticket_purpose_name),$("#ticket_category").val(a.ticket_category),$("#ticket_category_name").val(a.ticket_category_name),$("#name").val(a.name),$("#subject").val(a.subject),v("notes",a.notes),$("#is_visible").prop("checked",_(a.is_visible)),$("#modalFormInput").modal("show")}else s.HtmlNotification(m(t.data),`${t.status} - ${t.statusText}`);n("#list_datatable",!1)}).catch(t=>{s.Notification(t.toString()),n("#list_datatable",!1)})}function C(){if(_dataTableSelectedValues.length<=0){s.HtmlNotification("Select 1 atau more data.");return}s.Confirm(`Are you sure want to delete ${_dataTableSelectedValues.length} data?`,null,"warning").then(e=>{i(!0,"#delete"),n("#list_datatable"),_data2Send=new URLSearchParams({id:JSON.stringify(_dataTableSelectedValues)}),u(`${_baseURL}/configs/helpdesks/ticket-templates`,"DELETE",_data2Send).then(t=>{[200].includes(t.status)?(Toast.fire({icon:"success",title:t.statusText,text:t.data.message}),T(),c(!1)):s.HtmlNotification(m(t.data),`${t.status} - ${t.statusText}`),i(!1,"#delete"),n("#list_datatable",!1)}).catch(t=>{s.Notification(t.toString()),i(!1,"#delete"),n("#list_datatable",!1)})}).catch(e=>{e&&console.log(e)})}function c(e=!0){_dataTableResetFilter=!1,_dataTable.ajax.reload(null,e)}function f(){_action="create",_data2Send=null,_formValidation.resetForm(),$("#formInput")[0].reset(),$("#ticket_purpose").val(null),$("#ticket_category").val(null),$("#is_visible").prop("checked",!0),_formValidation.resetForm()}function O(){o(),$("#_dynamic_content").load(`${_baseURL}/lov/configs/helpdesks/purposes`,()=>{o(!1),$("#_modal_lov").modal("show"),$(".modal-dialog").addClass("modal-lg"),$("#_modal_lov").on("hide.bs.modal",function(){$resultFromLOV.result&&($("#ticket_purpose").val($resultFromLOV.data.id),$("#ticket_purpose_name").val($resultFromLOV.data.name))})})}function D(){$("#ticket_purpose").val()&&(o(),$("#_dynamic_content").load(`${_baseURL}/lov/configs/helpdesks/categories?ticket_purpose=${$("#ticket_purpose").val()}`,()=>{o(!1),$("#_modal_lov").modal("show"),$(".modal-dialog").addClass("modal-lg"),$("#_modal_lov").on("hide.bs.modal",function(){$resultFromLOV.result&&($("#ticket_category").val($resultFromLOV.data.id),$("#ticket_category_name").val($resultFromLOV.data.name))})}))}function I(){$('#filter_is_visible option[value=""]').prop("selected",!0).change(),$("#formFilter")[0].reset()}document.addEventListener("DOMContentLoaded",function(){S(),L(),x(),V(),E()});

import{f as _}from"./application-BtXPZOJh.js";import{b as p,i as b,a as g,c as v,e as n,M as i,s,f as u,r as m,g as x,h as r,_ as T}from"./general-DAK3ebw_.js";let c=null;const y=document.querySelector("#formInput");let d=null;function S(){_dataTable=$("#list_datatable").DataTable({lengthMenu:[[10,25,50,100,-1],[10,25,50,100,"All"]],pageLength:50,numbers_length:4,searchDelay:500,processing:!0,serverSide:!0,scrollX:!0,stateSave:_dataTableUseState,stateDuration:_dataTableStateDuration,scrollY:_dataTableScrollY,order:[[0,"asc"]],select:{items:"row",style:"single",className:"bg-warning"},headerCallback:function(e,t,a,l,V){e.getElementsByTagName("th")[0].innerHTML=`
            <div class="form-check">
               <input class="form-check-input datatable-group-checkable" type="checkbox" value="" id="groupCheckable" />
					<label class="form-check-label"></label>
            </div>`},createdRow:function(e,t,a){_dataTableSelectedValues.indexOf(t[_dataTableSelectColumn])>-1&&$(e).addClass("bg-light")},ajax:{url:`${_baseURL}/dt/configs/users`,type:"GET",data:function(e){e.is_active=$("#filter_is_active").val(),e.role=$("#filter_role").val()}},columns:[{data:"id",width:"30px",orderable:!1,searchable:!1,render:function(e,t,a,l){return`<div class="form-check">
                               <input class="form-check-input datatable-checkable" type="checkbox" value="${e}" ${_dataTableSelectedValues.indexOf(e)>-1?"checked":""} data-index="${l.row}" />
                                        <label class="form-check-label"></label>
                            </div>`}},{data:"username"},{data:"email"},{data:"name",render:function(e,t,a,l){return`<div class="d-flex flex-column">
                               ${a.name}
                               <small class="text-muted text-xs">${a.emp_code}</small>
                            </div>`}},{data:"role.name"},{data:"department.code",name:"departments.code"},{data:"site",render:function(e,t,a,l){return`<div class="d-flex flex-column">
                               ${a.site.code}
                               <small class="text-muted text-xs">${a.site.entity.code}</small>
                            </div>`}},{data:"priority"},{data:"is_active",className:"dt-center",searchable:!1,render:function(e,t,a,l){return p(e)?'<span class="badge font-weight-normal badge-success">Yes</span>':'<span class="badge font-weight-normal badge-warning">No</span>'}}]}).on("xhr.dt",function(e,t,a,l){setTimeout(()=>{_dataTable.columns.adjust()},300)}).on("draw.dt",function(e,t,a,l){b(_dataTable)}),g(_dataTable,'input[type="search"]'),document.querySelector("#refresh").addEventListener("click",()=>o(!1)),document.querySelector("#filterReset").addEventListener("click",N),document.querySelector("#formFilter").addEventListener("submit",e=>{e.preventDefault(),o(),$("#modalFormFilter").modal("hide")})}function k(){_formValidation=$(y).validate({rules:{username:{required:!0,regex:_regExpForUsername},email:{required:!0,email:!0},password:{minlength:8},name:{required:!0},emp_code:{required:!0},role:{required:!0},entity:{required:!0},site:{required:!0},department:{required:!0},priority:{required:!0}},submitHandler:q})}function h(){_action==="create"?$("#password").rules("add",{required:!0}):$("#password").rules("remove","required")}function w(){$("#modalFormInput").on("hidden.bs.modal",f),$("#modalFormInput").on("show.bs.modal",h),v("#modalFormInput"),$("#entity").on("change",function(){$(this).val()&&_("#site",`${_baseURL}/s2/configs/setups/sites/${$(this).val()}`,d?d.site_id:null)})}function E(){_permissions.edit&&document.querySelector("#edit").addEventListener("click",()=>{typeof _dataTable.row({selected:!0}).data()>"u"||F(_dataTable.row({selected:!0}).data().id.trim())}),_permissions.delete&&document.querySelector("#delete").addEventListener("click",D)}function L(){n("#username"),n("#password"),n("#email"),n("#name"),n("#emp_code")}function q(){i.Confirm("Are you sure?").then(e=>{s(!0,"#save"),c=`${_baseURL}/configs/users`,_action==="edit"&&(c+=`/${_id}`);const t=_action==="create"?"POST":"PUT",a=$("#is_active").is(":checked")?"":"&is_active=false";_data2Send=$("#formInput").serialize()+a,u(c,t,_data2Send).then(l=>{[201,200].includes(l.status)?(_action="create",Toast.fire({icon:"success",title:l.statusText,text:l.data.message}),f(),o(!1),$("#modalFormInput").modal("hide")):(i.HtmlNotification(m(l.data),`${l.status} - ${l.statusText}`),x(l.data.errors)),s(!1,"#save")}).catch(l=>{i.Notification(l.toString()),s(!1,"#save")})}).catch(e=>{e&&console.log(e)})}function F(e=null){_id=e,r("#list_datatable"),u(`${_baseURL}/configs/users/${_id}`,"GET",null).then(t=>{if([200].includes(t.status)){f(),_action="edit";const a=t.data.data;d=a,$("#username").val(a.username),$("#email").val(a.email),$("#name").val(a.name),$("#emp_code").val(a.emp_code),$('#role option[value="'+a.role_id+'"]').prop("selected",!0).change(),$('#department option[value="'+a.department_id+'"]').prop("selected",!0).change(),$('#priority option[value="'+a.priority+'"]').prop("selected",!0).change(),$('#entity option[value="'+a.site.entity_id+'"]').prop("selected",!0).change(),$("#is_active").prop("checked",p(a.is_active)),$("#modalFormInput").modal("show"),h()}else i.HtmlNotification(m(t.data),`${t.status} - ${t.statusText}`);r("#list_datatable",!1)}).catch(t=>{i.Notification(t.toString()),r("#list_datatable",!1)})}function D(){if(_dataTableSelectedValues.length<=0){i.HtmlNotification("Select 1 atau more data.");return}i.Confirm(`Are you sure want to delete ${_dataTableSelectedValues.length} data?`,null,"warning").then(e=>{s(!0,"#delete"),r("#list_datatable"),_data2Send=new URLSearchParams({id:JSON.stringify(_dataTableSelectedValues)}),u(`${_baseURL}/configs/users`,"DELETE",_data2Send).then(t=>{[200].includes(t.status)?(Toast.fire({icon:"success",title:t.statusText,text:t.data.message}),T(),o(!1)):i.HtmlNotification(m(t.data),`${t.status} - ${t.statusText}`),s(!1,"#delete"),r("#list_datatable",!1)}).catch(t=>{i.Notification(t.toString()),s(!1,"#delete"),r("#list_datatable",!1)})}).catch(e=>{e&&console.log(e)})}function o(e=!0){_dataTableResetFilter=!1,_dataTable.ajax.reload(null,e)}function f(){_action="create",_data2Send=null,_formValidation.resetForm(),$("#formInput")[0].reset(),$('#role option[value=""]').prop("selected",!0).change(),$('#department option[value=""]').prop("selected",!0).change(),$('#entity option[value=""]').prop("selected",!0).change(),$("#site").val(null).empty().trigger("change"),$("#site").prop("disabled",!0),$("#is_active").prop("checked",!0),d=null}function N(){$('#filter_is_active option[value=""]').prop("selected",!0).change(),$('#filter_role option[value=""]').prop("selected",!0).change(),$("#formFilter")[0].reset()}document.addEventListener("DOMContentLoaded",function(){S(),k(),w(),L(),E()});

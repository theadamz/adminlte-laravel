import{i as p,a as k,t as f,c as b,M as l,s,f as o,r as h,h as c,u as y,g as x,_ as g}from"./general-DAK3ebw_.js";const w=document.querySelector("#formInput"),D=document.querySelector("#formDuplicate");let v=[],m=null,S=null;_dataTableSelectColumn="code";function E(){_dataTable=$("#list_datatable").DataTable({iDisplayLength:-1,bLengthChange:!1,dom:`<'row'
               <'col-sm-6 d-flex align-items-center justify-conten-start'l>
            >
               <'table-responsive'tr>
            <'row'
               <'col-sm-12 col-md-5 d-flex align-items-center justify-content-center justify-content-md-start'i>

            >`,info:!0,scrollX:!0,scrollY:_dataTableScrollY,select:{items:"row",style:"single",className:"bg-warning"},headerCallback:function(a,e,t,r,n){a.getElementsByTagName("th")[0].innerHTML=`
            <div class="form-check">
               <input class="form-check-input datatable-group-checkable" type="checkbox" value="" id="groupCheckable" />
					<label class="form-check-label"></label>
            </div>`},createdRow:function(a,e,t){_dataTableSelectedValues.indexOf(e[_dataTableSelectColumn])>-1&&$(a).addClass("bg-light")},data:v,columns:[{data:"code",width:"30px",orderable:!1,searchable:!1,defaultContent:"",className:"details-control dt-center",render:function(a,e,t,r){return`<div class="d-flex align-items-center">
                           <div class="form-check form-check-custom form-check-sm me-4">
                              <input class="form-check-input datatable-checkable" type="checkbox" value="${a}" ${_dataTableSelectedValues.indexOf(a)>-1?"checked":""} data-index="${r.row}" />
                           </div>
                        </div>`}},{data:"name",orderable:!1},{data:"permissions",orderable:!1,render:function(a,e,t,r){let n="";for(const[u,i]of Object.entries(a))n+=i?`<span class="badge font-weight-normal badge-success mr-1 text-bold">${u}</span>`:`<span class="badge font-weight-normal badge-danger mr-1 text-bold">${u}</span>`;return n}}]}).on("draw.dt",function(a,e){p(_dataTable),_dataTable.columns.adjust()}),k(_dataTable,'input[type="search"]'),document.querySelector("#refresh").addEventListener("click",()=>d())}function N(a){const e=$(this).data("flag"),t=$(this).is(":checked");m[e]=t}function L(){_formValidation=$(w).validate({rules:{access_lists:{required:!0}},submitHandler:O}),S=$(D).validate({rules:{from_role:{required:!0},to_role:{required:!0}},submitHandler:F})}function C(){f("#access_lists"),$("#modalFormInput").on("hidden.bs.modal",_),b("#modalFormInput"),f("#role","Select",null,!1),$("#role").on("select2:select",function(a){_dataTable.clear().draw(),$("#addMoreMenu").prop("disabled",!1),d(),$('input[type="search"]').val(null)}),$("#modalFormDuplicate").on("hidden.bs.modal",T),b("#modalFormDuplicate"),f("#from_role"),f("#to_role"),f("#exclude_accesses"),document.querySelector("#saveEditAccess").addEventListener("click",U)}function A(){_permissions.edit&&document.querySelector("#edit").addEventListener("click",()=>{typeof _dataTable.row({selected:!0}).data()>"u"||R(_dataTable.row({selected:!0}).data().code)}),_permissions.delete&&document.querySelector("#delete").addEventListener("click",H)}function O(){if($("#access_lists").val().length<=0||$("#role").val().trim()==""){l.Notification("Select role and access.");return}l.Confirm("Are you sure?").then(a=>{s(!0,"#save");const e=`${_baseURL}/configs/accesses`;_data2Send=new URLSearchParams({role:$("#role").val(),access_lists:JSON.stringify($("#access_lists").val())}),o(e,"POST",_data2Send).then(t=>{[201,200].includes(t.status)?(l.HtmlNotification(t.data.message,null,"success"),_(),d(),$("#modalFormInput").modal("hide")):l.HtmlNotification(h(t.data),`${t.status} - ${t.statusText}`),s(!1,"#save")}).catch(t=>{l.Notification(t.toString()),s(!1,"#save")})}).catch(a=>{a&&console.log(a)})}function R(a=null){_id=a,c("#list_datatable"),o(`${_baseURL}/configs/accesses/${$("#role").val()}/${_id}`,"GET",null).then(e=>{if([200].includes(e.status)){_(),_action="edit";const t=e.data.data;$("#editAccess").val(`${t.code} - ${t.name}`);const r=_accesses.find(u=>u.code==t.code);m=t.permissions,$("#editAccessContainer").html(null),$(".check-access").off("click");let n="";for(const[u,i]of Object.entries(r.permissions))n+=`<div class="form-check mx-5">
                            <input class="form-check-input  check-access" type="checkbox" value="true"
                                    id="edit_access_${i}"
                                    name="edit_access_${i}"
                                    data-flag="${i}"
                                    ${t.permissions[i]?"checked":""}/>
                            <label class="form-check-label" for="edit_access_${i}">${i}</label>
                        </div>`;$("#editAccessContainer").html(n),$(".check-access").on("click",N),$("#modalFormEdit").modal("show")}else l.HtmlNotification(h(e.data),`${e.status} - ${e.statusText}`);c("#list_datatable",!1)}).catch(e=>{l.Notification(e.toString()),c("#list_datatable",!1)})}function U(){if(y(m)){l.Notification("Silahkan lakukan perubahan sebelum simpan.");return}l.Confirm("Are you sure?").then(a=>{s(!0,"#saveEditAccess"),_data2Send=new URLSearchParams({code:_id,permissions:JSON.stringify(m)}),o(`${_baseURL}/configs/accesses/${$("#role").val()}`,"PUT",_data2Send).then(e=>{[200].includes(e.status)?(Toast.fire({icon:"success",title:e.statusText,text:e.data.message}),m=null,d(),$("#modalFormEdit").modal("hide")):l.HtmlNotification(h(e.data),`${e.status} - ${e.statusText}`),s(!1,"#saveEditAccess")}).catch(e=>{l.Notification(e.toString()),s(!1,"#saveEditAccess")})}).catch(a=>{a&&console.log(a)})}function F(){l.Confirm("Are you sure?","Duplicate").then(a=>{s(!0,"#saveDuplicate"),_data2Send=new URLSearchParams({from_role:$("#from_role").val(),to_role:$("#to_role").val(),exclude_accesses:JSON.stringify($("#exclude_accesses").val())}),o(`${_baseURL}/configs/accesses/duplicate`,"POST",_data2Send).then(e=>{[201].includes(e.status)?(_action="create",l.HtmlNotification(e.data.message,`${e.statusText}`,"success"),$("#modalFormDuplicate").modal("hide"),T(),d()):(l.HtmlNotification(h(e.data),`${e.status} - ${e.statusText}`),x(e.data.errors)),s(!1,"#saveDuplicate")}).catch(e=>{l.Notification(e.toString()),s(!1,"#saveDuplicate")})}).catch(a=>{console.log(a)})}function H(){if(_dataTableSelectedValues.length<=0){l.HtmlNotification("Select 1 atau more.");return}l.Confirm(`Are you sure want to delete ${_dataTableSelectedValues.length} data?`,null,"warning").then(a=>{s(!0,"#delete"),c("#list_datatable"),_data2Send=new URLSearchParams({role:$("#role").val(),id:JSON.stringify(_dataTableSelectedValues)}),o(`${_baseURL}/configs/accesses`,"DELETE",_data2Send).then(e=>{[200].includes(e.status)?(Toast.fire({icon:"success",title:e.statusText,text:e.data.message}),g(),d()):l.HtmlNotification(h(e.data),`${e.status} - ${e.statusText}`),s(!1,"#delete"),c("#list_datatable",!1)}).catch(e=>{l.Notification(e.toString()),s(!1,"#delete"),c("#list_datatable",!1)})}).catch(a=>{a&&console.log(a)})}function _(){_action="create",_data2Send=null,$("#access_lists").val(null).trigger("change"),_formValidation.resetForm(),$("#formInput")[0].reset()}function T(){_data2Send=null,$("#from_role").val(null).trigger("change"),$("#to_role").val(null).trigger("change"),$("#exclude_accesses").val(null).trigger("change"),S.resetForm(),$("#formDuplicate")[0].reset()}async function d(){if(!$("#role").val())return;c("#list_datatable");const a=await o(`${_baseURL}/configs/accesses/${$("#role").val()}`,"GET",null);if(![200].includes(a.status)){_dataTable.clear().draw(),c("#list_datatable",!1);return}v=a.data.data,_dataTable.clear(),_dataTable.rows.add(a.data.data).search($('input[type="search"]').val()).draw(),g(),c("#list_datatable",!1)}document.addEventListener("DOMContentLoaded",function(){E(),L(),C(),A()});

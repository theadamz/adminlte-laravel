import{m as p,i as g,a as T,c as h,y,k as S,n as v,e as x,M as i,s as l,f as d,r,g as _,h as o,z as D,_ as k,l as c}from"./general-DAK3ebw_.js";let u=null;const w=document.querySelector("#formInput");let f=null;const F=document.querySelector("#formImport");function L(){_dataTable=$("#list_datatable").DataTable({lengthMenu:[[10,25,50,100,-1],[10,25,50,100,"All"]],pageLength:50,numbers_length:4,searchDelay:500,processing:!0,serverSide:!0,scrollX:!0,stateSave:_dataTableUseState,stateDuration:_dataTableStateDuration,scrollY:_dataTableScrollY,order:[[0,"asc"]],select:{items:"row",style:"single",className:"bg-warning"},headerCallback:function(t,e,a,n,q){t.getElementsByTagName("th")[0].innerHTML=`
          <div class="form-check">
             <input class="form-check-input datatable-group-checkable" type="checkbox" value="" id="groupCheckable" />
        <label class="form-check-label"></label>
          </div>`},createdRow:function(t,e,a){_dataTableSelectedValues.indexOf(e[_dataTableSelectColumn])>-1&&$(t).addClass("bg-light")},ajax:{url:`${_baseURL}/dt/configs/setups/holidays`,type:"GET",data:function(t){t.start_date=$("#filter_date").data("daterangepicker").startDate.format("YYYY-MM-DD"),t.end_date=$("#filter_date").data("daterangepicker").endDate.format("YYYY-MM-DD")}},columns:[{data:"id",width:"30px",orderable:!1,searchable:!1,render:function(t,e,a,n){return`<div class="form-check">
                             <input class="form-check-input datatable-checkable" type="checkbox" value="${t}" ${_dataTableSelectedValues.indexOf(t)>-1?"checked":""} data-index="${n.row}" />
                                      <label class="form-check-label"></label>
                          </div>`}},{data:"site_name"},{data:"holiday_date",render:function(t,e,a,n){return p(t)}},{data:"description"}]}).on("xhr.dt",function(t,e,a,n){setTimeout(()=>{_dataTable.columns.adjust()},300)}).on("draw.dt",function(t,e,a,n){g(_dataTable)}),T(_dataTable,'input[type="search"]'),document.querySelector("#refresh").addEventListener("click",()=>s(!1)),document.querySelector("#filterReset").addEventListener("click",P),document.querySelector("#formFilter").addEventListener("submit",t=>{t.preventDefault(),s(),$("#modalFormFilter").modal("hide")})}function E(){_formValidation=$(w).validate({rules:{holiday_date:{required:!0,dateValid:!0},description:{required:!0}},submitHandler:Y}),f=$(F).validate({rules:{file:{required:!0,accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",extension:"xlsx",filesize:2048}},submitHandler:N})}function I(){$("#modalFormInput").on("hidden.bs.modal",m),h("#modalFormInput"),y("#holiday_date","date"),S("#filter_date"),v("#filter_date",moment().startOf("year"),moment().endOf("year")),$("#modalFormImport").on("hidden.bs.modal",()=>{b(),$("#formImport")[0].reset()}),h("#modalFormImport")}function M(){_permissions.edit&&document.querySelector("#edit").addEventListener("click",()=>{typeof _dataTable.row({selected:!0}).data()>"u"||R(_dataTable.row({selected:!0}).data().id.trim())}),_permissions.delete&&document.querySelector("#delete").addEventListener("click",V)}function C(){x("#description")}function Y(){i.Confirm("Are you sure?").then(t=>{l(!0,"#save"),u=`${_baseURL}/configs/setups/holidays`,_action==="edit"&&(u+=`/${_id}`);const e=_action==="create"?"POST":"PUT";_data2Send=new URLSearchParams({holiday_date:moment($("#holiday_date").datetimepicker("viewDate")).format("YYYY-MM-DD"),description:$("#description").val(),entity:$("#entity").val(),site:$("#site").val()}),d(u,e,_data2Send).then(a=>{[201,200].includes(a.status)?(_action="create",Toast.fire({icon:"success",title:a.statusText,text:a.data.message}),m(),s(!1),$("#modalFormInput").modal("hide")):(i.HtmlNotification(r(a.data),`${a.status} - ${a.statusText}`),_(a.data.errors)),l(!1,"#save")}).catch(a=>{i.Notification(a.toString()),l(!1,"#save")})}).catch(t=>{t&&console.log(t)})}function R(t=null){_id=t,o("#list_datatable"),d(`${_baseURL}/configs/setups/holidays/${_id}`,"GET",null).then(e=>{if([200].includes(e.status)){m(),_action="edit";const a=e.data.data;D("#holiday_date",moment(a.holiday_date)),$("#description").val(a.description),$("#modalFormInput").modal("show")}else i.HtmlNotification(r(e.data),`${e.status} - ${e.statusText}`);o("#list_datatable",!1)}).catch(e=>{i.Notification(e.toString()),o("#list_datatable",!1)})}function V(){if(_dataTableSelectedValues.length<=0){i.HtmlNotification("Select 1 atau more data.");return}i.Confirm(`Are you sure want to delete ${_dataTableSelectedValues.length} data?`,null,"warning").then(t=>{l(!0,"#delete"),o("#list_datatable"),_data2Send=new URLSearchParams({id:JSON.stringify(_dataTableSelectedValues)}),d(`${_baseURL}/configs/setups/holidays`,"DELETE",_data2Send).then(e=>{[200].includes(e.status)?(Toast.fire({icon:"success",title:e.statusText,text:e.data.message}),k(),s(!1)):i.HtmlNotification(r(e.data),`${e.status} - ${e.statusText}`),l(!1,"#delete"),o("#list_datatable",!1)}).catch(e=>{i.Notification(e.toString()),l(!1,"#delete"),o("#list_datatable",!1)})}).catch(t=>{t&&console.log(t)})}function s(t=!0){_dataTableResetFilter=!1,_dataTable.ajax.reload(null,t)}function m(){_action="create",_data2Send=null,_formValidation.resetForm(),$("#formInput")[0].reset()}async function N(){if(!await i.Confirm("Are you sure?").catch(a=>{a&&console.log(a)}))return;$("#upload_info").val(null),l(!0,"#upload"),c(!0),_data2Send=new FormData($("#formImport")[0]);const e=await d(`${_baseURL}/configs/setups/holidays/imports`,"POST",_data2Send,null);if(![201].includes(e.status)){l(!1,"#upload"),c(!1),i.HtmlNotification(r(e.data),`${e.status} - ${e.statusText}`),_(e.data.errors,f),$("#upload_info").val(e.data.info);return}l(!1,"#upload"),c(!1),Toast.fire({icon:"success",title:e.statusText,text:e.data.message}),$("#upload_info").val(e.data.info),b(),s(!1),$("#modalFormInput").modal("hide")}function b(){_data2Send=null,f.resetForm(),$("#file").next().html("Choose file"),$("#file").val("")}function P(){$('#filter_region option[value=""]').prop("selected",!0).change(),$('#filter_is_active option[value=""]').prop("selected",!0).change(),$("#formFilter")[0].reset()}document.addEventListener("DOMContentLoaded",function(){I(),L(),E(),C(),M()});
